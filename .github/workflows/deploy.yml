name: Build and Deploy HR Import Service

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven
    
    - name: Build with Maven
      run: mvn -B package -DskipTests
    
    - name: Run Tests
      run: mvn test
    
    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: hr-import-service
        path: target/*.jar

  run-image:
    needs: build
    uses: ./.github/workflows/run-docker-on-github.yml
    with:
      image: hr-import-service:latest
      build: true
      context: .
      dockerfile: Dockerfile
      ports: ""
      env: ""
      run_args: ""
      run_cmd: ""
    secrets:
      # pass your registry credentials if you need to pull/push images; optional if you only build locally
      docker_registry_username: ${{ secrets.DOCKER_USERNAME }}
      docker_registry_password: ${{ secrets.DOCKER_PASSWORD }}
